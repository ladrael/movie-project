<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.itwillbs.movie.mapper.MovieRegisterMapper">

<select id="selectMovies" resultType="hashmap">
	SELECT * FROM movieinfo
</select>

<insert id="registMovie">
		INSERT INTO movieinfo
			VALUES(
				     #{info_movie_code}
				   , #{info_movie_title}
				   , #{info_movie_poster}
				   , #{info_story}
				   , #{info_year}
				   , #{info_time}
				   , #{info_showdate}
				   , #{info_enddate} 
				   , '0'	-- likeCount
				   , #{info_director}
				   , #{info_nation}
				   , #{info_rating}
				   , #{info_genre}
			)
</insert>

<select id="selectMovie" resultType="hashmap">
	SELECT * 
	  FROM movieinfo
	 WHERE info_movie_code = #{info_movie_code}
</select>

<delete id="deleteMovie">
	DELETE 
	  FROM movieinfo
     WHERE info_movie_code = #{info_movie_code}
</delete>

<!--수정 -->
<update id="updateMovie">
	UPDATE movieinfo 
		SET info_movie_code = #{info_movie_code}
		  , info_movie_title = #{info_movie_title}
		  , info_movie_poster = #{info_movie_poster}
		  , info_story = #{info_story}
		  , info_year = #{info_year}
		  , info_time = #{info_time}
		  , info_showdate = #{info_showdate}
		  , info_enddate = #{info_enddate}
	  WHERE info_movie_code = #{info_movie_code}
</update>

<select id="selectScreen" resultType="hashmap">
	SELECT screen_name,screen_code,location_code
	  FROM cinema 
	  LEFT JOIN screen 
	         ON cinema.cinema_code = screen.screen_cinema_code
     WHERE cinema_name = #{cinema_name}
     ORDER BY screen_name
</select>

<select id="selectCinema" resultType="hashmap">
	SELECT * FROM cinema
</select>

<!-- 영화상영일정 -->
<insert id="scheduleRegister">
INSERT INTO schedule
		VALUES (
			   (SELECT *
		          FROM (SELECT IFNULL(MAX(CAST(sch_code AS UNSIGNED)), 0) + 1
						  FROM schedule) A)
			 , #{sch_screen_code}
			 , #{sch_cinema_code}
			 , #{sch_movie_code}
			 , #{sch_movie_date}	
			 , #{sch_start_time}
			 , #{sch_last_time}
			 , #{location_code}
			 ) 
</insert>
<!-- 영화상영일정목록 -->
<select id="selectScheduleList" resultType="hashmap">
	SELECT 
		sch_code
		,screen.screen_name
		,cinema.cinema_name 
		,movieinfo.info_movie_title
		,sch_movie_date
		,sch_start_time
		,sch_last_time
		,sch_location
  FROM schedule
  LEFT JOIN screen ON screen.screen_code = sch_screen_code 
  LEFT JOIN cinema ON cinema.cinema_code = sch_cinema_code
  LEFT JOIN movieinfo ON movieinfo.info_movie_code = sch_movie_code
</select>

<select id="cinemaNameSort" resultType="hashmap">
	SELECT 
		sch_code
		,screen.screen_name
		,cinema.cinema_name 
		,movieinfo.info_movie_title
		,sch_movie_date
		,sch_start_time
		,sch_last_time
		,sch_location
  FROM schedule
  LEFT JOIN screen ON screen.screen_code = sch_screen_code 
  LEFT JOIN cinema ON cinema.cinema_code = sch_cinema_code
  LEFT JOIN movieinfo ON movieinfo.info_movie_code = sch_movie_code
  ORDER BY cinema.cinema_name
</select>

<select id="screenNameSort" resultType="hashmap">
	SELECT 
		sch_code
		,screen.screen_name
		,cinema.cinema_name 
		,movieinfo.info_movie_title
		,sch_movie_date
		,sch_start_time
		,sch_last_time
		,sch_location
  FROM schedule
  LEFT JOIN screen ON screen.screen_code = sch_screen_code 
  LEFT JOIN cinema ON cinema.cinema_code = sch_cinema_code
  LEFT JOIN movieinfo ON movieinfo.info_movie_code = sch_movie_code
  ORDER BY screen.screen_name
</select>

<select id="movieNameSort" resultType="hashmap">
	SELECT 
		sch_code
		,screen.screen_name
		,cinema.cinema_name 
		,movieinfo.info_movie_title
		,sch_movie_date
		,sch_start_time
		,sch_last_time
		,sch_location
  FROM schedule
  LEFT JOIN screen ON screen.screen_code = sch_screen_code 
  LEFT JOIN cinema ON cinema.cinema_code = sch_cinema_code
  LEFT JOIN movieinfo ON movieinfo.info_movie_code = sch_movie_code
  ORDER BY movieinfo.info_movie_title
</select>

<select id="schDateSort" resultType="hashmap">
SELECT 
		sch_code
		,screen.screen_name
		,cinema.cinema_name 
		,movieinfo.info_movie_title
		,sch_movie_date
		,sch_start_time
		,sch_last_time
		,sch_location
  FROM schedule
  LEFT JOIN screen ON screen.screen_code = sch_screen_code 
  LEFT JOIN cinema ON cinema.cinema_code = sch_cinema_code
  LEFT JOIN movieinfo ON movieinfo.info_movie_code = sch_movie_code
  ORDER BY sch_movie_date
</select>

<select id="schStartSort" resultType="hashmap">
SELECT 
		sch_code
		,screen.screen_name
		,cinema.cinema_name 
		,movieinfo.info_movie_title
		,sch_movie_date
		,sch_start_time
		,sch_last_time
		,sch_location
  FROM schedule
  LEFT JOIN screen ON screen.screen_code = sch_screen_code 
  LEFT JOIN cinema ON cinema.cinema_code = sch_cinema_code
  LEFT JOIN movieinfo ON movieinfo.info_movie_code = sch_movie_code
  ORDER BY sch_start_time
</select>

<select id="schLastSort" resultType="hashmap">
	SELECT 
			sch_code
			,screen.screen_name
			,cinema.cinema_name 
			,movieinfo.info_movie_title
			,sch_movie_date
			,sch_start_time
			,sch_last_time
			,sch_location
	FROM schedule
	LEFT JOIN screen ON screen.screen_code = sch_screen_code 
	LEFT JOIN cinema ON cinema.cinema_code = sch_cinema_code
	LEFT JOIN movieinfo ON movieinfo.info_movie_code = sch_movie_code
	ORDER BY sch_last_time
</select>

<select id="selectSchedule" resultType="hashmap">
	SELECT 
		sch_code
		,screen.screen_name
		,cinema.cinema_name 
		,movieinfo.info_movie_title
		,sch_movie_date
		,sch_start_time
		,sch_last_time
		,sch_location
	 FROM schedule
	 LEFT JOIN screen ON screen.screen_code = sch_screen_code 
	 LEFT JOIN cinema ON cinema.cinema_code = sch_cinema_code
	 LEFT JOIN movieinfo ON movieinfo.info_movie_code = sch_movie_code
	WHERE sch_code = #{sch_code}
</select>
<update id="updateSchedule">
<!-- 	UPDATE schedule  -->
<!-- 		SET sch_movie_date = #{sch_movie_date} -->
<!-- 		  , sch_start_time = #{sch_start_time} -->
<!-- 		  , sch_last_time = #{sch_last_time} -->
<!-- 	  WHERE sch_code = #{sch_code} -->
</update>
<delete id="deleteSchedule">
	DELETE 
	  FROM schedule
     WHERE sch_code = #{sch_code}
</delete>


<!-- info_movie_code -->
<!-- info_movie_title -->
<!-- info_movie_poster -->
<!-- info_story -->
<!-- info_year -->
<!-- info_time -->
<!-- info_showdate -->
<!-- info_enddate -->
<!-- like_count -->


















</mapper>
